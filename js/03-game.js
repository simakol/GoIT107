/**
 * –ù–∞–ø–∏—à–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –¥–ª—è —ñ–≥—Ä–æ–≤–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∞.
 * –î–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π –≥–æ—Ç–æ–≤—É —Ä–æ–∑–º—ñ—Ç–∫—É HTML —Ç–∞ –±–∞–∑–æ–≤—É —Å—Ç–∏–ª—ñ–∑–∞—Ü—ñ—é.
 *
 * –ü—ñ—Å–ª—è –Ω–∞—Ç–∏—Å–Ω–µ–Ω–Ω—è –Ω–∞ –∫–Ω–æ–ø–∫—É "Start game"
 * –≤ –∫–æ–∂–Ω–æ–º—É –≤—ñ–∫–æ–Ω—Ü—ñ –ø–æ —á–µ—Ä–∑—ñ –º–∞—î –∑'—è–≤–ª—è—Ç–∏—Å—å
 * —Å–º–∞–π–ª–∏–∫ –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é –≤ 1 —Å–µ–∫—É–Ω–¥—É ('ü§ë' –∞–±–æ 'üëø')
 *
 * –ü—ñ–¥ —á–∞—Å –æ–±—Ä–æ–±–∫–∏ –∫–æ–∂–Ω–æ–≥–æ –≤—ñ–∫–æ–Ω—Ü—è —Å—Ç–≤–æ—Ä–∏ –º–∞—Å–∏–≤ –∑ Promis-–∞–º–∏
 * –≤ —è–∫–æ–º—É –∫–æ–∂–µ–Ω –∑ –Ω–∏—Ö –±—É–¥–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –∑–∞ —Å–≤–æ—î –≤—ñ–∫–æ–Ω—Ü–µ,
 * –ø—ñ—Å–ª—è —á–æ–≥–æ –æ–±—Ä–æ–±–∏ –¥–∞–Ω–∏–π –º–∞—Å–∏–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–µ—Ç–æ–¥—É Promise.allSettled
 *
 * –ü—ñ—Å–ª—è —Ç–æ–≥–æ —è–∫ –≤—Å—ñ –≤—ñ–∫–æ–Ω—Ü—è –±—É–ª–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ
 * —â–æ–± —Å–∫—Ä—ñ–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞–≤ —á–∏ –≥—Ä–∞–≤–µ—Ü—å –ø–µ—Ä–µ–º—ñ–≥, —á–∏ –Ω—ñ.
 * –Ø–∫—â–æ –≤ –∫–æ–∂–Ω–æ–º—É –≤—ñ–∫–æ–Ω—Ü—ñ –æ–¥–Ω–∞–∫–æ–≤–∏–π —Å–º–∞–π–ª–∏–∫ —Ü–µ –æ–∑–Ω–∞—á–∞—î —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–µ—Ä–µ–º—ñ–≥
 *
 * –í –ø–æ–ª–µ result –≤–∏–≤–æ–¥–∏—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Å—Ç–∞—Ç—É—Å –≥—Ä–∏ ('Winner' –∞–±–æ 'Loser')
 *
 * –ü—ñ—Å–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –Ω–∞ –∫–Ω–æ–ø–∫—É "Start game"
 * –ø–æ–ª–µ –º–∞—î –æ—á–∏—â–∞—Ç–∏—Å—å, –∞ –≥—Ä–∞ –ø–æ—á–∏–Ω–∞—Ç–∏—Å—å –∑ –ø–æ—á–∞—Ç–∫—É.
 */

/*
    1. –≤—ñ—à–∞—î–º–æ —Å–ª—É—Ö–∞—á –Ω–∞ –∫–Ω–æ–ø–∫—É —Å—Ç–∞—Ä—Ç + –±–ª–æ–∫—É—î–º–æ –∫–Ω–æ–ø–∫—É –ø–æ–∫–∏ –Ω–µ –∑–∞–∫—ñ–Ω—á–∏–ª–∞—Å—å –≥—Ä–∞
    2. —Å—Ç–≤–æ—Ä–∏—Ç–∏ –º–∞—Å–∏–≤ –ø—Ä–æ–º—ñ—Å—ñ–≤ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –¥—ñ—Ç–µ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É (–∑–∞–ø—É—Å—Ç–∏–º–æ –º–µ—Ç–æ–¥ map —è–∫–∏–π –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç—å –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç container.children –Ω–∞ –ø—Ä–æ–º—ñ—Å)
    3. –í—Å–µ—Ä–µ–¥–∏–Ω—ñ –º–µ–ø—É —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –ø—Ä–æ–º—ñ—Å —Ç–∞ —Ä–∞–Ω–¥–æ–º–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î–º–æ –π–æ–≥–æ —Å—Ç–∞–Ω —ñ —Ä–∞–Ω–¥–æ–º–Ω–æ –ø–µ—Ä–µ–≤–æ–¥–∏–º–æ –ø—Ä–æ–º—ñ—Å —É —Å—Ç–∞–Ω —Ñ—É–ª—Ñ—ñ–ª–¥ –∞–±–æ –≤ —Å—Ç–∞–Ω —Ä–µ–¥–∂–µ–∫—Ç–µ–¥
    4. –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–µ—Ç–æ–¥—É Promise.allSettled –æ–±—Ä–æ–±–∏–º–æ –º–∞—Å–∏–≤ —É—Å—ñ—Ö –ø—Ä–æ–º—ñ—Å—ñ–≤
    5. –æ—á–∏—â—É—î–º–æ —Å–ª–æ—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
    6. –Ω–∞–ø–æ–≤–Ω—é—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–º–∞–π–ª–∞–º–∏ –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ —Å—Ç–∞–Ω—É –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é –≤ 1 —Å–µ–∫—É–Ω–¥—É
    7. —Ä–æ–±–∏–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —è–∫—â–æ –≤—Å—ñ –ø—Ä–æ–º—ñ—Å–∏ –≤ —Å—Ç–∞–Ω—ñ —Ñ—É–ª—Ñ—ñ–ª–¥ –∞–±–æ –≤—Å—ñ –ø—Ä–æ–º—ñ–º–∏ –≤ —Å—Ç–∞–Ω—ñ —Ä–µ–¥–∂–µ–∫—Ç–µ–¥ - –º–∏ –ø–µ—Ä–µ–º–æ–≥–ª–∏, —ñ–Ω–∞–∫—à–µ - –ø—Ä–æ–≥—Ä–∞–ª–∏
*/

const startBtn = document.querySelector(".start-btn");
const container = document.querySelector(".container");
const result = document.querySelector(".result");

startBtn.addEventListener("click", handleStartGame);

function handleStartGame(event) {
  // step 1
  event.target.disabled = true;

  // step 2
  const promises = [...container.children].map((el) => {
    // step 3
    return new Promise((resolve, reject) => {
      const isPromiseFullfilled = Math.random() > 0.5;

      if (isPromiseFullfilled) {
        resolve("ü§ë");
      }

      reject("üëø");
    });
  });

  // step 4
  Promise.allSettled(promises).then((items) => {
    console.log(items);
    result.textContent = ""; // –æ—á–∏—â—É—î–º–æ –ø–æ–ª–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É

    // step 7
    const isWinner =
      items.every(({ status }) => status === "fulfilled") ||
      items.every(({ status }) => status === "rejected");
    // –º–∏ –ø–µ—Ä–µ–º–æ–≥–ª–∏, —è–∫—â–æ –∫–æ–∂–µ–Ω –ø—Ä–æ–º—ñ—Å –≤ —Å—Ç–∞–Ω—ñ fulfilled, –∞–±–æ —è–∫—â–æ –∫–æ–∂–µ–Ω –ø—Ä–æ–º—ñ—Å –≤ —Å—Ç–∞–Ω—ñ rejected

    items.forEach((item, i) => {
      // step 5
      container.children[i].textContent = ""; // –æ—á–∏—â—É—î–º–æ –∫–æ–∂–µ–Ω –æ–∫—Ä–µ–º–∏–π —Å–ª–æ—Ç –ø–æ –ø–æ—Ä—è–¥–∫—É

      // step 6
      setTimeout(() => {
        container.children[i].textContent = item.value || item.reason; // —è–∫—â–æ —É—Å–ø—ñ—à–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç–æ –≤ –æ–± º—î–∫—Ç—ñ item —Å–º–∞–π–ª–∏–∫ –±—É–¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏—Å—å —É –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ value, –∞ —è–∫—â–æ –Ω–µ —É—Å–ø—ñ—à–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, —Ç–æ —Å–º–∞–π–ª–∏–∫ –±—É–¥–µ —É –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ reason

        // —â–µ –æ–¥–∏–Ω –≤–∞—Ä—ñ–∞–Ω—Ç –ø—ñ–¥—Å—É–º–∫—É –≥—Ä–∏ (–º–µ–Ω—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π, —Ç–æ–º—É —â–æ –±—É–¥–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –∫–æ–∂–µ–Ω –≤–∏–∫–ª–∏–∫ —Ñ—É–∫–Ω—Ü—ñ—ó —Ç–∞–π–º–∞—É—Ç—É, –∞ —É –Ω–∞—Å —ó—Ö 3)
        // —Ä–æ–±–ª—é –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –Ω–∞ —Ç–µ, —â–æ —è –∑–Ω–∞—Ö–æ–¥–∂—É—Å—å –Ω–∞ –æ—Å—Ç–∞–Ω–Ω—å–æ–º—É –µ–ª–µ–º–µ–Ω—Ç—ñ –º–∞—Å–∏–≤—É –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
        // if (container.children.length - 1 === i) {
        //   event.target.disabled = false; // —Ä–æ–∑–±–ª–æ–∫—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –≥—Ä–∏
        //   result.textContent = isWinner ? "Winner" : "Loser (Try next time)";
        // }
      }, 1000 * (i + 1));
      /*1000 * (i + 1) - –¥–ª—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤ —Å–µ—Ç—Ç–∞–π–º–∞—É—Ç—É, –∑–∞–¥–∞—î–º–æ —Ä—ñ–∑–Ω–∏–π —á–∞—Å
      1. i = 0, 1000 * (0 + 1) -> 1000
      2. i = 1, 1000 * (1 + 1) -> 2000
      3. i + 2, 1000 * (2 + 1) -> 3000
      */
    });

    // –ø–æ–∫–∞–∑—É—î–º–æ –ø–µ—Ä–µ–º–æ–∂—Ü—è –ø—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –≤—Å—ñ —Å–ª–æ—Ç–∏ –ø–æ–∫–∞–∂—É—Ç—å—Å—è + —Ä–æ–∑–±–ª–æ–∫–æ–≤—É—î–º–æ –∫–Ω–æ–ø–∫—É
    setTimeout(() => {
      event.target.disabled = false; // —Ä–æ–∑–±–ª–æ–∫—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –≥—Ä–∏
      result.textContent = isWinner ? "Winner" : "Loser (Try next time)";
    }, container.children.length * 1000);
    //container.children.length * 1000 -> –¥–æ–≤–∂–∏–Ω–∞ —Å–ª–æ—Ç—ñ–≤ = 3, –∑–Ω–∞—á–∏—Ç—å –∑–∞—Ç—Ä–∏–º–∫–∞ –±—É–¥–µ —Ä—ñ–≤–Ω–∞ 3–º —Å–µ–∫—É–Ω–¥–∞–º
  });
}
