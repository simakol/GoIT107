/**
 * –ù–∞–ø–∏—à–µ–º–æ –∫–ª–∞—Å Timer, —è–∫–∏–π –±—É–¥–µ
 * –∑–∞–ø—É—Å–∫–∞—Ç–∏ —Ç–∞ –∑—É–ø–∏–Ω—è—Ç–∏ –≤—ñ–¥–ª—ñ–∫ —á–∞—Å—É
 */

class Timer {
  constructor({ onTick }) {
    this.onTick = onTick; // —Ñ—É–∫–Ω—Ü—ñ—è, —è–∫–∞ –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏—Å—å –∫–æ–∂–Ω—É —Å–µ–∫—É–Ω–¥—É –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    this.intervalID = 0; // —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ —Ç–∞–π–º–µ—Ä—É, –¥–ª—è —Ç–æ–≥–æ —â–æ–± –º–∏ –º–æ–≥–ª–∏ –π–æ–≥–æ –∑—É–ø–∏–Ω–∏—Ç–∏ –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –Ω–æ–ø–∫—É —Å—Ç–æ–ø
    this.isActive = false; // —Å—Ç–∞—Ç—É—Å —Ç–∞–π–º–µ—Ä–∞ (–∑–∞–ø—É—â–µ–Ω–∏–π, —á–∏ –Ω—ñ)

    this.initTimer();
  }

  initTimer() {
    const timeComponents = this.getTimeComponents(0);
    this.onTick(timeComponents); // –æ–±–Ω—É–ª—è—î–º–æ –≥–æ–¥–∏–Ω–Ω–∏–∫ –¥–æ –≤–∏–≥–ª—è–¥—É 00:00:00
  }

  start() {
    console.log("–Ω–∞—Ç–∏—Å–Ω—É–ª–∏ –Ω–æ–ø–∫—É —Å—Ç–∞—Ä—Ç");
    /*
    1. –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ —Ç–µ —á–∏ –∑–∞–ø—É—â–µ–Ω–Ω–∏–π —Ç–∞–π–º–µ—Ä, —è–∫—â–æ –∑–∞–ø—É—â–µ–Ω–Ω–∏–π - –≤–∏—Ö–æ–¥–∏–º–æ –∑ —Ñ—É–∫–Ω—Ü—ñ—ó
    2. –∑–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å —Ç–∞–π–º–µ—Ä–∞ –Ω–∞ –∞–∫—Ç–∏–≤–Ω–∏–π   this.isActive = true
    3. –±–µ—Ä–µ–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –Ω–∞ –∫–Ω–æ–ø–∫—É Date.now()
    4. –∑–∞–ø—É—Å–∫–∞—î–º–æ —ñ–Ω—Ç–µ—Ä–≤–∞–ª –∫–æ–∂–Ω—ñ 1000 –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥ (–∑–∞–ø–∏—Å—É—î–º–æ –∞–π–¥—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –≤  this.intervalID)
      4.1. –±–µ—Ä–µ–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å Date.now()
      4.2. –∑–Ω–∞—Ö–æ–¥–∏–º–æ —Ä—ñ–∑–Ω–∏—Ü—é –¥–≤–æ—Ö –¥–∞—Ç (–≤—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –≤—ñ–¥–Ω—ñ–º–∞—î–º–æ –º–∏–Ω—É–ª–∏–π(–∑–∞ –º–µ–∂–∞–º–∏ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É))
      4.3. –≤–∏–∫–ª–∏–∫–∞—î–º–æ –º–µ—Ç–æ–¥ getTimeComponents, –ø–µ—Ä–µ–¥–∞—î–º–æ —Ç—É–¥–∏ —Ä—ñ–∑–Ω–∏—Ü—é –¥–≤–æ—Ö –¥–∞—Ç (–º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∏) —ñ –æ—Ç—Ä–∏–º—É—î–º–æ –æ–± º—î–∫—Ç –∑ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º–∏ –≥–æ–¥–∏–Ω–∞–º–∏, —Ö–≤–∏–ª–∏–Ω–∞–º–∏ —ñ —Å–µ–∫—É–Ω–¥–∞–º–∏
      4.4. –≤–∏–∫–ª–∏–∫–∞—î–º–æ –º–µ—Ç–æ–¥ onTick —ñ –ø–µ—Ä–µ–¥–∞—î–º–æ –æ–± º—î–∫—Ç –≥–æ–¥–∏–Ω, —Ö–≤–∏–ª–∏–Ω —ñ —Å–µ–∫—É–Ω–¥ –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É
    */

    // step 1
    if (this.isActive) {
      return;
    }

    // –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—é –Ω–∞ —Å—Ç–∞—Ä—Ç - –æ–±–Ω—É–ª—è—î–º–æ —Ç–∞–π–º–µ—Ä —ñ –ø–æ—Ç—ñ–º –∑–∞–ø—É—Å–∫–∞—î–º–æ —Ä–∞—Ö—É–Ω–æ–∫
    this.initTimer();

    // step 2
    this.isActive = true;

    // step 3
    const startTime = Date.now();

    // step 4
    this.intervalID = setInterval(() => {
      // step 4.1
      const currentTime = Date.now();

      // step 4.2
      const diff = currentTime - startTime;

      // step 4.3
      const timeComponents = this.getTimeComponents(diff);

      // step 4.4
      this.onTick(timeComponents);
    }, 1000);
  }

  stop() {
    console.log("–Ω–∞—Ç–∏—Å–Ω—É–ª–∏ –Ω–æ–ø–∫—É —Å—Ç–æ–ø");
    /*
    1. –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ç–∞–π–º–µ—Ä—É, —è–∫—â–æ –≤—ñ–Ω –Ω–µ –∞–∫—Ç–∏–≤–Ω–∏–π - —Ç–æ –≤–∏—Ö–æ–¥–∏–º–æ –∑ –º–µ—Ç–æ–¥—É, —Ç–æ–º—É —â–æ –Ω–∞–º –Ω–µ–º–∞—î —á–æ–≥–æ –∑—É–ø–∏–Ω—è—Ç–∏
    2. –º—ñ–Ω—è—î–º–æ —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –Ω–∞ —Ñ–æ–ª–∑
    3. –∑—É–ø–∏–Ω—è—î–º–æ —ñ–Ω—Ç–µ—Ä–≤–∞–ª
    */

    // step 1
    if (!this.isActive) {
      return;
    }

    // step 2
    this.isActive = false;

    // step 3
    clearInterval(this.intervalID);
  }

  /*
   * - –ü—Ä–∏–π–º–∞—î —á–∞—Å –≤ –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∞—Ö
   * - –í–∏—Ä–∞—Ö–æ–≤—É—î —Å–∫—ñ–ª—å–∫–∏ –≤ –Ω–∏—Ö –≤–º—ñ—â–∞—î—Ç—å—Å—è –≥–æ–¥–∏–Ω/—Ö–≤–∏–ª–∏–Ω/—Å–µ–∫—É–Ω–¥
   * - –ü–æ–≤–µ—Ä—Ç–∞—î –æ–±'—î–∫—Ç –∑ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—è–º–∏ hours, mins, secs
   * - –ê–¥—Å—å–∫–∞ –∫–æ–ø—ñ–ø–∞—Å—Ç–∞ –∑ stackoverflow üí©
   */
  getTimeComponents(time) {
    const hours = this.pad(
      Math.floor((time % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))
    );
    const mins = this.pad(Math.floor((time % (1000 * 60 * 60)) / (1000 * 60)));
    const secs = this.pad(Math.floor((time % (1000 * 60)) / 1000));

    return { hours, mins, secs };
  }

  /*
   * –ü—Ä–∏–π–º–∞—î —á–∏—Å–ª–æ, –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –π–æ–≥–æ –≤ —Ä—è–¥–æ–∫ —ñ –¥–æ–¥–∞—î –≤ –ø–æ—á–∞—Ç–æ–∫ 0, —è–∫—â–æ —á–∏—Å–ª–æ –º–µ–Ω—à–µ 2-—Ö –∑–Ω–∞–∫—ñ–≤
   */
  pad(value) {
    return String(value).padStart(2, "0");
  }
}

const startBtn = document.querySelector("button[data-action-start]");
const stopBtn = document.querySelector("button[data-action-stop]");
const clockface = document.querySelector(".js-clockface");

const timer = new Timer({
  onTick: updateClockface,
});

startBtn.addEventListener("click", timer.start.bind(timer));
stopBtn.addEventListener("click", timer.stop.bind(timer));

/*
 * - –ü—Ä–∏–π–º–∞—î —á–∞—Å –≤ –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∞—Ö
 * - –í–∏—Ä–∞—Ö–æ–≤—É—î —Å–∫—ñ–ª—å–∫–∏ –≤ –Ω–∏—Ö –≤–º—ñ—â–∞—î—Ç—å—Å—è –≥–æ–¥–∏–Ω/—Ö–≤–∏–ª–∏–Ω/—Å–µ–∫—É–Ω–¥
 * - –†–∏—Å—É—î —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
 */
function updateClockface({ hours, mins, secs }) {
  clockface.textContent = `${hours}:${mins}:${secs}`;
}
